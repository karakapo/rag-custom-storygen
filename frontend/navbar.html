<!-- Flash messages -->
<div id="flash-messages"></div>

<!-- Navbar -->
<nav class="navbar">
    <div class="logo">
        <a href="index.html" style="text-decoration: none; color: inherit;">
            <span>NarraNova.ai</span>
        </a>
    </div>
    <div class="nav-links">
        <a href="create.html" id="createStoryNav">Hikaye Oluştur</a>
        <a href="#">Keşfet</a>
        <a href="#">Kategoriler</a>
        <a href="#">Yazarlar</a>
        <a href="#">Hakkımızda</a>
    </div>
    <div class="navbar-menu">
        <div class="auth-buttons" id="authButtons">
            <a href="login.html" class="login-btn">Giriş Yap</a>
            <a href="register.html" class="signup-btn">Ücretsiz Kaydol</a>
        </div>
        <div class="user-menu" id="userMenu" style="display: none;">
            <span class="username" id="username"></span>
            <a href="#" class="btn-small btn-logout" id="logoutBtn">Çıkış</a>
        </div>
    </div>
</nav>

<script>
    // Navbar işlemleri
    document.addEventListener('DOMContentLoaded', async () => {
        const createStoryNav = document.getElementById('createStoryNav');
        const authButtons = document.getElementById('authButtons');
        const userMenu = document.getElementById('userMenu');
        const username = document.getElementById('username');
        const logoutBtn = document.getElementById('logoutBtn');

        try {
            const response = await fetch('/api/auth/check', {
                credentials: 'include'
            });
            const data = await response.json();
            
            if (data.authenticated) {
                createStoryNav.href = 'create.html';
                authButtons.style.display = 'none';
                userMenu.style.display = 'flex';
                username.textContent = data.username;
                
                logoutBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    try {
                        await fetch('/api/auth/logout', {
                            method: 'POST',
                            credentials: 'include'
                        });
                        window.location.href = 'index.html';
                    } catch (error) {
                        console.error('Logout error:', error);
                    }
                });
            } else {
                createStoryNav.href = 'login.html';
                authButtons.style.display = 'flex';
                userMenu.style.display = 'none';
            }
        } catch (error) {
            console.error('Auth check error:', error);
            createStoryNav.href = 'login.html';
            authButtons.style.display = 'flex';
            userMenu.style.display = 'none';
        }

        // Flash messages
        const flashMessages = document.getElementById('flash-messages');
        const urlParams = new URLSearchParams(window.location.search);
        const message = urlParams.get('message');
        const type = urlParams.get('type');
        
        if (message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type || 'info'}`;
            alertDiv.textContent = message;
            flashMessages.appendChild(alertDiv);
            
            // Remove message from URL
            const newUrl = window.location.pathname;
            window.history.replaceState({}, document.title, newUrl);
        }
    });
</script> 